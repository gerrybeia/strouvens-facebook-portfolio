var dataPopup = [];
dataPopup['navSearch'] = 	{'top':'Aucun résultat','middle':"Mais que cherchez-vous de plus ?!",'bottom':'Terminer','loading':'1'} 
dataPopup['home'] = 		{'top':"Erreur de navigation",'middle':"Vous êtez déjà sur l'accueil...",'bottom':'Ah ok, pardon !','loading':''}
dataPopup['displayAll'] = 	{'top':"Erreur d'affichage",'middle':"Il n'y a rien à afficher de plus, tout se trouve sous vos yeux !",'bottom':'Ok','loading':'1'} 
dataPopup['settings'] = 	{'top':"Erreur de timing",'middle':"Vous paramétrerez tout ça plus tard, vous n'avez certainement pas le temps !",'bottom':'Vous avez raison','loading':''} 
dataPopup['logout'] = 		{'top':"Erreur de (dé)connexion",'middle':"Ne comptez pas sur moi pour vous aider à partir !",'bottom':'Je vais me débrouiller','loading':''} 
dataPopup['help'] = 		{'top':"Aide",'middle':"Si cette page ne s'affiche pas, veuillez vérifier que :<ul><li>1. Votre ordinateur est allumé</li><li>2. Vous êtes connecté à Internet</li><li>3. Internet Explorer s'est bien ouvert</li><li>4. Votre licence Windows est authentique</li><li>5. Votre antivirus ne bloque pas l'accès à ce site</li></ul><br><u>Après toutes ces vérifications</u> (et malgré tous vos efforts, j'en suis convaincu), si vous n'arrivez toujours pas à visualiser cette page, appelez-moi au <b>+243991267675</b>.",'bottom':'Merci','loading':'1'} 
dataPopup['newDesign'] = 	{'top':"Un nouveau design pour une nouvelle vie",'middle':"Rien à dire.",'bottom':'Cool','loading':''} 
dataPopup['feedBack'] = 	{'top':"Feedback",'middle':"Les <del>filles</del> gens adorent donner leur avis. Cet espace est fait pour ça, alors n'hésitez pas !<br><br>",'bottom':"J'ai fini !",'loading':'1'} 
dataPopup['ad'] = 			{'top':"Le partage, c'est la vie !",'middle':"Vous souhaitez m'aider à diffuser mon CV Facebook ? C'est gentil à vous ! Voici quelques boutons qui vous seront utiles :",'bottom':"C'est fait !",'loading':''} 
dataPopup['yourProfile'] = 	{'top':"Erreur : votre profil semble indisponible",'middle':"Vous ne pouvez pas accéder à votre profil pour l'instant. En attendant, vous pouvez continuer de consulter le mien.",'bottom':"D'accord",'loading':''} 
dataPopup['privacy'] = 		{'top':"Confidentialité",'middle':"Ce profil est entièrement ouvert au public et le restera.",'bottom':"Tant mieux !",'loading':''} 
dataPopup['welcome'] = 		{'top':"Bienvenue",'middle':"Avec toute mon affection, je vous souhaite la bienvenue !",'bottom':"Merci",'loading':''} 
dataPopup['discuss'] = 		{'top':"Discuter dans la vraie vie",'middle':"Si vous préférez me contacter par téléphone, voici mon numéro : 0649854199. <br>Il m'arrive de répondre, d'écouter mes messages vocaux et même parfois de rappeler !",'bottom':"J'appelle de suite",'loading':''} 
dataPopup['sameFriend'] = 	{'top':"Ami en commun",'middle':"A ma connaissance, je suis le seul ami que vous et cette personne ayiez en commun. Mais c'est déjà pas mal !",'bottom':"Je note",'loading':''} 
dataPopup['video'] = 		{'top':"Erreur de codec",'middle':"Je ne suis actuellement pas disponible en vidéo. Pour me parler face à face il va falloir prendre rendez-vous !",'bottom':"Fermer",'loading':''} 
dataPopup['addFriend'] = 	{'top':"Impossible d'ajouter des amis",'middle':"Plus on est de fous plus on rit, on est d'accord là-dessus. Mais là c'est entre vous et moi !",'bottom':"C'est vous qui décidez",'loading':''} 
dataPopup['emptyEmail'] = 	{'top':"Erreur d'email",'middle':"Entrez votre email (le vrai si vous souhaitez une réponse !).",'bottom':"Ah oui !",'loading':'1'} 
dataPopup['emptyMessage'] = {'top':"Erreur de contenu",'middle':"Un message sans message n'est par définition pas un message !",'bottom':"Ah ben oui !",'loading':'1'} 
dataPopup['sendMessage'] = 	{'top':"Filtre anti-spam",'middle':"Ce message va réellement m'être envoyé sur ma boîte mail. Êtes-vous sûr de vouloir l'expédier ?",'bottom':"Et comment !",'loading':''} 
dataPopup['seeDate'] = 		{'top':"Un peu d'histoire",'middle':"Il s'est passé pas mal de choses ce jour-ci... Tenez-vous réellement à ce que je vous en fasse la liste ?",'bottom':"Non merci ça ira !",'loading':'1'} 
dataPopup['adolescence'] = 	{'top':"Erreur : violation d'intimité",'middle':"Mon enfance et adolescence vous intéressent ? Prenons donc rendez-vous pour en parler : écrivez-moi un message ou appellez-moi au +243991267675.",'bottom':"J'ai hâte !",'loading':'1'} 
dataPopup['metz'] = 		{'top':"Quelques mots sur... Metz",'middle':"Metz est la préfecture de la région Lorraine, dans l'Est de la France. Elle compte 120 000 habitants, un club de football historique, une cathédrale, un <del>Virgin Megastore</del>, quelques cinémas et un Centre Pompidou un peu plus joli que son aîné parisien.",'bottom':"Ca a l'air chouette !",'loading':'1'} 
dataPopup['paris'] = 		{'top':"Quelques mots sur... Paris",'middle':"Capitale française mondialement célèbre, Paris réussit l'exploit de contenir plus de 2 millions d'habitants dans 100km<sup>2</sup>. Je ne vous ferai pas ici la liste de ses bâtiments et lieux historiques. Ca m'ennuierait autant que vous !",'bottom':"Ouf",'loading':'1'} 
dataPopup['nancy'] = 		{'top':"Quelques mots sur... Nancy",'middle':"Nancy est en Lorraine, plus précisément en Meurthe-et-Moselle. La phrase pleine d'ironie de l'auteur contemporain Booba dans 'Kalash' (« [...] amuse-toi bien en Meurthe-et-Moselle ») illustre parfaitement ce département.",'bottom':"Izi",'loading':'1'} 
dataPopup['montreuil'] = 	{'top':"Quelques mots sur... Montreuil",'middle':"Complètement à l'Est de Paris, collée au préphérique, Montreuil-sois-Bois est située en Seine-Saint-Denis. Prenez la ligne 9 direction Porte-de-Montreuil et arrêtez-vous à Croix-de-Chavaux. Traversez la place du marché (comptez 25 minutes si c'est jour de marché) et vous arrivez chez moi ! Bougez pas je descends.",'bottom':"J'arrive",'loading':'1'} 
dataPopup['champigny'] = 	{'top':"Quelques mots sur... Champigny-sur-Marne",'middle':"Ville du 94, c'est à peu près tout ce que je sais de cette municipalité. Un oeil sur Wikipédia vous en dira sûrement plus...",'bottom':"Merci du renseignement...",'loading':'1'} 
dataPopup['novel'] = 		{'top':"Vous êtez éditeur ?",'middle':"Si vous travaillez dans une maison d'édition, je peux vous envoyer le script. Sinon contentez-vous du roman de ma vie sous forme de timeline Facebook !",'bottom':":(",'loading':'1'} 
dataPopup['likePeople'] = 	{'top':"Top secret",'middle':"Pour des raisons de confidentialité et de sécurité (notamment celle de l'Etat), je ne peux vous montrer la liste des personnes ayant liké ce post. Je m'en excuse et espère que vous comprenez.",'bottom':"Ok mec",'loading':'1'} 
dataPopup['about'] = 		{'top':"Informations confidentielles",'middle':"Je ne suis pas habilité à vous en dire davantage sur moi sur ce site. Pour en savoir plus, merci de prendre rendez-vous :<br>- par email : <a href='mailto:thomas.strouvens@gmail.com' target='_blank'>thomas.strouvens@gmail.com</a><br>- par téléphone : +243991267675",'bottom':"Merci du renseignement",'loading':''} 
dataPopup['photos'] = 		{'top':"Il y a pas photo",'middle':"Pourquoi vouloir voir des photos de moi alors que vous avez l'occasion de me voir en vrai ?! Un petit message et votre curiosité sera rapidement satisfaite !",'bottom':"Très bien",'loading':''} 
dataPopup['friends'] = 		{'top':"Vous cherchez des amis ?",'middle':"Malheureusement, mes amis préfèrent rester discrets... Mais promis, je vous les présenterai lorsqu'on sera collègues !",'bottom':"Trop hâte !",'loading':''} 
dataPopup['places'] = 		{'top':"Vous me cherchez ?",'middle':"Né à Aix-en-Provence, j'ai vécu à Avignon, Metz, Nancy et Paris... Satisfait ?",'bottom':"Oh oui !",'loading':''} 
dataPopup['music'] = 		{'top':"Quand la musique est bonne",'middle':"Demandez donc à mes voisins ce que j'écoute, ils doivent savoir !",'bottom':"Ok",'loading':''} 
dataPopup['movies'] = 		{'top':"Coupez !",'middle':"Je vais au cinéma chaque semaine, intéressant n'est-ce pas ?",'bottom':"Oh que oui",'loading':''} 
dataPopup['tv'] = 			{'top':"Zappez votre chemin",'middle':"Je ne regarde pas la télé, pas de chance hein ?!",'bottom':"Zut",'loading':''} 
dataPopup['books'] = 		{'top':"Un peu de lecture",'middle':"J'ai appris à lire au CP, avec J'aime lire et Ratus. J'ai depuis lu de nombreux livres, que je ne vous citerai que si vous m'en faites la demande par écrit au : 9 rue Marcel Sembat 93100 Montreuil.",'bottom':"Je vous envoie ça",'loading':''} 
dataPopup['likes'] = 		{'top':"JTM",'middle':"J'aime bien les animaux, les pâtes, faire du bruit avec mes doigts, jouer à PES 2006 et lire aux toilettes.",'bottom':"Passionnant",'loading':''} 
dataPopup['groups'] = 		{'top':"Mes groupes",'middle':"Je ne suis ni franc-maçon, ni raëlien, ni témoin de Jéhovah. Je n'ai pas de groupe de rap non plus. Je suis par contre membre de <a href='https://www.facebook.com/groups/73462544825/?fref=ts' target='_blank'>Ceux qui ont enfermé le papy dans le frigo dans Tomb Raider</a>.",'bottom':"Nooooon moi aussi !",'loading':''} 
dataPopup['inviteFriend'] = {'top':"Impossible d'ajouter cet ami",'middle':"Afin d'ajouter cette personne à votre liste d'amis, je vous propose tout d'abord de me rencontrer. Je me ferai ensuite un plaisir de vous présenter !",'bottom':"Ok dac",'loading':'1'} 
dataPopup['noChatTo'] = 	{'top':"Erreur de destination",'middle':"Désolé mais vous n'avez pas le choix du destinataire ! Si vous voulez envoyer un email à une autre personne, je vous propose d'utiliser un service tel que Gmail ou Outlook.",'bottom':"Merci du conseil",'loading':''} 
dataPopup['augustin'] = 	{'top':"Tout va bien ?",'middle':"Vous ne l'avez peut-être pas encore remarqué, mais vous vous trouvez déjà sur mon profil ! Concentrez-vous un peu s'il vous plaît, c'est un CV très sérieux ici.",'bottom':"Pardon",'loading':''} 
dataPopup['news'] = 		{'top':"Au coeur de l'actualité",'middle':"La principale actualité de ce jour est que je cherche actuellement un poste dans le web ! Je vous laisse parcourir mon profil et me contacter si vous voulez en savoir un peu plus.",'bottom':"Ca marche",'loading':''} 
dataPopup['messages'] = 	{'top':"Boîte de réception",'middle':"Vous n'avez aucun nouveau message.",'bottom':"Oooooh...",'loading':''} 
dataPopup['events'] = 		{'top':"Agenda",'middle':"N'oubliez pas votre rendez-vous avec Thomas Strouvens dans les prochains jours !",'bottom':"Je m'en souviendrai",'loading':''} 
dataPopup['boss'] = 		{'top':"Signaler ce contenu",'middle':"Je vous propose d'aller de ce pas dans le bureau de votre cher patron afin de lui montrer mon CV. S'il est intéressé par mon profil, merci de m'envoyer un message ou de me contacter au +243991267675. Promis, je vous revaudrai ça !",'bottom':"J'y cours !",'loading':''} 
dataPopup['skills'] = 		{'top':"Mes compétences",'middle':"Issu d'une formation généraliste, je suis un 'touche à tout'. Même si mon profil correspond davantage à un développeur front-end (HTML5/CSS3, JQuery/JS, Php), je connais bien Photoshop ce qui me permet de concevoir et designer des pages web. D'un naturel créatif, j'aime produire, créer et proposer mes idées. [...]<br><br> Pour en savoir plus, vous n'avez qu'un petit message à m'envoyer !",'bottom':"Nickel",'loading':''} 
dataPopup['language'] = 	{'top':"Changer la langue",'middle':"Je n'ai pas encore eu le temps de traduire mon CV, mais ça viendra ne vous inquiétez pas :)",'bottom':"J'espère",'loading':''} 

var ticker;
var dataTicker = [];
dataTicker['addFriend1'] = 		{'text': 'Ajouter','top': '272px','left': '158px','right': 'inherit','bottom': 'inherit','class':''};
dataTicker['addFriend2'] = 		{'text': 'Ajouter','top': '301px','left': '158px','right': 'inherit','bottom': 'inherit','class':''};
dataTicker['addFriend3'] = 		{'text': 'Ajouter','top': '330px','left': '158px','right': 'inherit','bottom': 'inherit','class':''};
dataTicker['addFriend4'] = 		{'text': 'Ajouter','top': '359px','left': '158px','right': 'inherit','bottom': 'inherit','class':''};
dataTicker['chatSettings'] = 	{'text': 'Options','top': 'inherit','left': '149px','right': 'inherit','bottom': '38px','class':''};
dataTicker['chatNewMessage'] = 	{'text': 'Nouveau message','top': 'inherit','left': '175px','right': 'inherit','bottom': '38px','class':''};
dataTicker['chatClose'] = 		{'text': "Fermer l'onglet",'top': 'inherit','left': 'inherit','right':'19px','bottom':'288px','class':'right'};
dataTicker['chatSet'] = 		{'text': 'Options','top': 'inherit','left': 'inherit', 'right':'21px', 'bottom':'288px','class':'middle'};
dataTicker['chatVideo'] = 		{'text': "Augustin n’est pas actuellement disponible pour un appel vidéo",'top': 'inherit','left': 'inherit', 'right':'65px', 'bottom':'288px','class':'right'};
dataTicker['chatAdd'] = 		{'text': 'Ajouter des amis à la discussion','top': 'inherit','left': 'inherit', 'right':'-1px', 'bottom':'288px','class':'middle'};
dataTicker['chatAdd2'] = 		{'text': 'Ajouter des amis à la discussion','top': 'inherit','left': 'inherit', 'right':'43px', 'bottom':'288px','class':'right'};
dataTicker['chatPic'] = 		{'text': 'Vous-même','top': 'inherit','left': 'inherit', 'right':'274px', 'bottom':'195px','class':'middle-right'};
dataTicker['likeCMF'] = 		{'text': 'Plein de gens aiment Color My Facebook !','top': 'inherit','left': 'inherit', 'right':'274px', 'bottom':'195px','class':'right'};

var iFriends = -1;
var dataFriends = [];

var windowX;

$(document).ready(function() {

	getLikes();
	getToday();
	getThisYear();
	checkYearDisplayed();
	tinyMenu();
	//GLOBAL EVENTS
		
		//flyout
		$('#chatSettings').add('#journal').add('#chooseDate').add('#fbTimelineHeadline .more').on('click',showFlyout);

		//ticker
		ticker = $('#tickerTitle');

		$('.tickerOn').on({
			'mouseover':showTicker,
			'mouseout':hideTicker
		});

		$('#timeline').find('.tickerOn').add('.commentNb').off().on({
			'mouseover':showTickerTimeline,
			'mouseout':hideTicker
		});

		windowX = $(window).width();
		$(window).resize(function(){
			windowX = $(window).width();
		});

		//beeper
		$('#beeper').delay(1000).fadeIn(300).delay(10000).fadeOut(1500).on({
			mouseover :function(){
				$(this).stop(true);
			},
			mouseout :function(){
				$(this).fadeOut(1500);
			},
			click: function(e){
				if(!$(e.target).hasClass('close')){
					showMessage();
				}
				$(this).hide();
			}
		});
		setTimeout(function(){
			$('#fbNotifications').find('.hasNew').removeClass('hasNew');
			document.title = "(1) Facebook";
		},2500);

		//popup
		$('#popup').on('click',function(e){hidePopup(e);});
		$('.popupOn').on('click',showPopup);
		$('.likeNb').add('.likes>a').on('click',function(){showPopup('likePeople');});

	//END

	//NAV EVENTS
		$('#navIco').find('.ico').add('#accountSettings').on('click',topNav);
		$('#fbMessages').find('.header a').add('#navPost>a').on('click',showMessage);
		$('#friendRequests').find('.action').on('click',hideInvit);
		$('.newFriend').find('.confirm').on('click',showMessage);

	//TIMELINE EVENTS
		var tl = $('#timeline');

		$('#fbTimelineHeadline').find('.message').add($('#fbTimelineHeadline').find('.like')).add($('#createPage>a')).on('click',showMessage);
		tl.find('.action a').on('click',postAction);
		tl.find('.commentNb').add($('#timeline').find('.showAllComments')).on('click',showComments);
		tl.find('.likeNb').on('click',showTicker);
		$('.writeComment').find('textarea').on('keypress',function(e){writeComment(e);});
		$('.list-comments').find('.like').on('click',likeComment);
		$('#yearList').find('a').add('.dateLink a').add('#dateList a').on('click',showYear);
		$('.twoColumn').find('.close').on('click',deletePost);
		tl.find('.twoColumn').find('.header>a').add(tl.find('.twoColumn').find('.name')).on('click',function(){showPopup('augustin');})
		

	//CHAT EVENTS
		var fbChat = $('#fbChat');
		fbChat.find('.close').on('click',hideMessage);
		$('#conversationContent').on('click',function(){
			fbChat.find('textarea').focus();
		});
		fbChat.find('textarea').on('keypress',function(e){checkMessage(e);});

	//SIDEBAR EVENTS
		$('#chatNewMessage').on('click',showMessage);
		$('#availablePeople').on('click',showConversation);
		$('#sidebarSearch').find('input').add('#inputSearch input').on('keyup',showPopup);
		$('#turnOnChat').add('#chatToggle').on('click',chatToggle);
		$('#otherPeople').find('.delete').on('click',deleteFriend);
	//END
	
});

// *** GLOBAL FUNCTIONS *** //
	
	// show the popup window with good content
	function showPopup(id){
		if(id.target)
			id = $(this).attr('data-popup');

		var th = $('#popup');
		th.find('.top .content').html(dataPopup[id]['top']);
		th.find('.middle.content').html(dataPopup[id]['middle']);
		th.find('#hidePopup').html(dataPopup[id]['bottom']);

		if(id=='feedBack'){
			$('.fb-comments').clone().appendTo(th.find('.middle.content'));
		}
		else if(id=='ad'){
			$('#socialShare').clone().appendTo(th.find('.middle.content'));
		}
		else if(id=='sendMessage'){
			th.find('.bottom').addClass('twoButtons').find('#hidePopup').on('click',function(){
				sendMessage();
				th.find('.bottom').removeClass('twoButtons');
				$('#hidePopup').off();
			});
		}

		th.fadeIn(200);
		if(dataPopup[id]['loading']=='1'){
			setTimeout(function(){
				$('#popup>div').addClass('content');
				setTimeout(function(){
					$('#popup>div').addClass('show');
				},1000);
			},500);
		}
		else
			$('#popup>div').addClass('content').addClass('show');
		$('.bodyMain').css('top','-'+$('body').scrollTop()+'px');
		$('body').css({'height':$(window).height()}).addClass('fixed');
		$('#hidePopup').focus();
	}

	// hide the popup window
	function hidePopup(e){
		var id = $(e.target).attr('id');
		if(id=='popup'||id=='closePopup'||id=='hidePopup'||id=='cancelSend'){
			$('#popup').hide().children().removeClass('content').removeClass('show');
			$('body').css({'height':$('.bodyMain').height()}).scrollTop(-1*parseInt($('.bodyMain').css('top'))).removeClass('fixed');
			$('.bodyMain').css('top','');
		}
	}

	// show subnav
	function showFlyout(t){
		var th = $(this);
		th.addClass('selected').removeClass('hasNew').next().show();
		hideTicker();
		setTimeout(function(){
			$('html').on('click',function(){
				th.removeClass('selected').next().hide();
				setTimeout(function(){
					$('html').off();
				},300);
			});
		},300);
	}

	// show ticker with the good text and at the right position
	function showTicker(){
		var a = $(this).attr('data-tip');
		ticker.attr('class',dataTicker[a]['class']).find('span').text(dataTicker[a]['text']);
		ticker.css({
			'left':dataTicker[a]['left'],
			'right':dataTicker[a]['right'],
			'top':dataTicker[a]['top'],
			'bottom':dataTicker[a]['bottom'],
			'position':'fixed'
		}).show();
	}

	function hideTicker(){
		ticker.hide();
	}

	function showTickerTimeline(){
		var th = $(this);
		var p = th.offset();
		var left = p.left;
		var top = p.top;

		if(th.hasClass('commentNb')){
			ticker.find('span').text('Afficher les commentaires');
			ticker.css({
				'right':windowX-left-24,
				'top':top-31,
				'bottom':'inherit',
				'left':'inherit',
				'position':'absolute'
			}).attr('class','right').show();;
		}
		else {
			var a = th.attr('data-tip');
			var tab = a.split(',').length;
			var nb = parseInt(th.text());
			
			if(th.hasClass('likeNb')){
				txt = a+' et '+(nb-tab)+' autres personnes aiment ça.';
			}
			else {
				txt = a+' et '+(nb-tab)+' autres personnes.';
			}
			ticker.find('span').text(txt);
			
			// ticker's position					
			ticker.css({
				'right':windowX-left-24,
				'top':top-31,
				'bottom':'inherit',
				'left':'inherit',
				'position':'absolute'
			}).attr('class','right').show();
		}
	}

	function getLikes(){
		$.ajax({
		  url: "http://graph.facebook.com/?id=http://iwebya.fr/colorfb",
		  dataType : "jsonp",
		  success: function(text){
		  	$('#cmf .likeNb').text(text.shares).parent().next().find('.likes>a').text(text.shares+' personnes');	
		  }
		});
		$.ajax({
		  url: "http://graph.facebook.com/?id=http://jesuisbonne.fr",
		  dataType : "jsonp",
		  success: function(text){
		  	$('#jesuisbonne .likeNb').text(text.shares).parent().next().find('.likes>a').text(text.shares+' personnes');	
		  }
		});
	}

	function getToday(){
		var today = new Date();
		var days  = ['dimanche','lundi','mardi','mercredi','jeudi','vendredi','samedi'];
		var months  = ['janvier','février','mars','avril','mai','juin','juillet','août','septembre','octobre','novembre','décembre'];
		var h = today.getHours()-1;
		if(h<10)
			h = '0'+h;
		var min = today.getMinutes()-9;
		if(min<10)
			min = '0'+min;
		$('#today').attr('title',days[today.getDay()]+' '+today.getDate()+' '+months[today.getMonth()]+' '+today.getFullYear()+', '+h+':'+min).text(today.getDate()+' '+months[today.getMonth()]);
	}

	function getThisYear(){
		var today = new Date();
		$('#thisYear').text(today.getFullYear());
	}

// *** TIMELINE FUNCTIONS *** //

	function showYear(){
		var id = $(this).attr('href');  
	    $('html, body').animate({  
	        scrollTop:($(id).offset().top-120) 
	    }, 'slow');
	    /*id= id.replace('#','');
	    id= id.replace('year','y');
	    $('#yearList').find('.selected').add($('.'+id)).add('#dateList .selected').toggleClass('selected');
	      
	    $('#chooseDate').text($(this).text());*/
	    return false;
	}

	// click on "J'aime" or "Commenter" on a post
	function postAction(){
		var th = $(this);
		var parent = th.parent().parent();

		if(th.hasClass('like')){
			var nb = th.parent().find('.likeNb');
			var i = parseInt(nb.text());

			if(!th.hasClass('dislike')){
				th.toggleClass('dislike').text("Je n'aime plus");
				nb.text(i+1);
				parent.find('.likes').prepend('<span class="you">Vous et </span>').find('a').text(i+' autres personnes').next().text('aimez ça.');
				parent.addClass('showComments');
			}
			else {
				th.toggleClass('dislike').text("J'aime");
				nb.add().text(i-1);
				parent.find('.likes').find('.you').remove().next().text((i-1)+' personnes').next().text('aiment ça.');
			}
		}
		else if(th.hasClass('comment')){
			parent.addClass('showComments').find('textarea').focus();
		}
	}

	// show comments list on a post
	function showComments(){
		var th = $(this);
		var parent = th.parent().parent();

		parent.addClass('showComments');

		if(th.hasClass('commentNb')){
			parent.find('.list-comments').addClass('showComments');
		}
	}

	// publish a comment in a post
	function writeComment(e){
		var code = (e.keyCode ? e.keyCode : e.which);
		if(code==13){
			e.preventDefault();
			var th = $(e.target);
			var html = "<li class='clearfix'><a class='yourPic' data-popup='yourProfile'><img src='img/unknown.png'></a><div class='content'><a class='name' data-popup='yourProfile'>Vous-même</a><p>"+th.val()+"</p><a class='time' data-popup='seeDate'>il y a quelques secondes</a> · <a class='like'>J'aime</a></div></li>";
	        th.val('');
	        var newLI = th.parent().prev().addClass('showComments').append(html).find('li').last();
	        newLI.find('a').not('.like').on('click',showPopup);
	        newLI.find('.like').on('click',likeComment);

	        var nb = th.parent().parent().prev().find('.commentNb');
			var i = parseInt(nb.text());
			if(isNaN(i)){
				i = 1;
			}
			else {
				i += 1;
			}
			nb.removeClass('no-comment').text(i);
		}
	}

	// click on "J'aime" in a post
	function likeComment(){
		var th = $(this);
		th.toggleClass('unlike');
		if(!th.hasClass('unlike'))
			th.text("J'aime");
		else 
			th.text("Je n'aime plus");
	}

	//show tiny nav when scrolling on timeline
	function tinyMenu(){
		$(window).scroll(function(){
			var scrl = $(window).scrollTop();
			var scrlH = 310;

			if(scrl>=scrlH){
				$('#tinyTimelineHeadline').addClass('show');
			}
			else {
				$('#tinyTimelineHeadline').removeClass('show').find('.more.selected').removeClass('selected').next().hide();
			}
		});
	}

	//
	function checkYearDisplayed(){
		var posTab = [];
		var a = 0;
		$('.dateLink a').each(function(){
			var id = $(this).attr('href');
			id = id.replace('#','');
	    	id = id.replace('year','y');
			posTab[a] = {'year':id,'top':$(this).offset().top};
			a++;
		});
		posTab[a] = {'year':'end','top':400000};
		var pos = -1;
		$(window).scroll(function(){
			var scrl = $(window).scrollTop()+200;

			for(i=-1;i<posTab.length+1;i++){
				if(scrl<posTab[i+1]['top']){
					if(pos!=i){						
						pos = i;
						if(i>=0)
							id = posTab[i]['year'];
			    		else
			    			id = "about"
			    		$('#yearList').find('.selected').add($('.'+id)).add('#dateList .selected').toggleClass('selected');	      
			    		$('#chooseDate').text($('#yearList').find('.selected').text());
	    			}
	    			return;
				}
			}
		});
	}

	// click on "supprimer" in a post
	function deletePost(){
		$(this).parent().slideUp().queue(function(){
			$(this).remove();
			if($('#timeline').find('.close').length==0){
				alert('Vous êtes content ?');
			}
		});
	}

// *** END TIMELINE FUNCTIONS *** //


// *** NAV FUNCTIONS *** //
	
	//show subnav when clicking on 3 main icons
	function topNav(){
		var th = $(this);
		if(th.parent().hasClass('selected')){
			th.parent().removeClass('selected');
		}
		else {
			$('#pageNav').find('.selected').removeClass('selected');
			th.removeClass('hasNew').parent().addClass('selected');
			setTimeout(function(){
				$('html').on('click',function(e){
					if( !$(e.target).hasClass('ico'))
						$('#pageNav').find('.selected').removeClass('selected');
				});
			},200);
		}
		$('html').off();
		if(th.parent().attr('id')=='friendRequests'){
			document.title = "Facebook";
		}
	}

	//click on "Pas maintenant" button
	function hideInvit(){
		$('#friendRequests').find('.content').addClass('noContent');
	}


// *** NEW MESSAGE FUNCTIONS *** //
	
	// open "new message" window
	function showMessage(){
		var th = $('#fbChat');

		if($(this).hasClass('proMessage')){
			th.find('.newMessageLink span').text("Proposition d'embauche");
			th.find('textarea').val("On t'embauche mon gars !");
		}
		else {
			th.find('.newMessageLink span').text("Nouveau message");
			th.find('textarea').val('');
		}

		th.attr('class','').show().find('input').focus();
	}

	// close "new message" window
	function hideMessage(){
		$('#fbChat').hide();
	}

	// check email and new message
	function checkMessage(e){
		var th = $('#fbChat');
		var code = (e.keyCode ? e.keyCode : e.which);
		if(code==13){
			e.preventDefault();
			var regexp = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/ ;
			var email = th.find('input').val();
			//get email value
			if(!regexp.test(email)&&th.hasClass('conversation')){
				email = prompt('Veuillez indiquer votre email que je puisse vous répondre :');
				th.find('input').val(email);
			}
			if(!regexp.test(email)){
				showPopup('emptyEmail');	
			}
			else if(th.find('textarea').val()==''){
				th.find('input').val(email);
				showPopup('emptyMessage');
			}
			else {
				showPopup('sendMessage');
			}
		}
	}

	// send new email
	function sendMessage(){
		var th = $('#fbChat');
		var email = th.find('input').val();
		var message = th.find('textarea').val();
		$.ajax({
			type: 'POST',
			url: 'scripts/contact.php',
			data: "email="+email+"&message="+message,
			success: function(response){
				if(response!='error'){
					$('#fbTimelineHeadline').find('.like').html('<i></i>Proposition envoyée');
					var txt = $('#conversationContent').find(".message").html();
					if(txt)
						txt+='<br>';
					$('#conversationContent').addClass('show').find(".message").html(txt+th.find('textarea').val());
					$('#conversationDate').text("Aujourd'hui");
					showConversation();
					th.find('textarea').val('');

					// show thanks message on beeper
					$('#beeper').find('.text').html('<b>Thomas Strouvens</b> vous remercie pour votre<br> message.');
					$('#beeper').fadeIn(300).delay(4000).fadeOut(1500);
				}
				else {
					alert("Il semble qu'il y ait eu une erreur...");
				}
			}
		});
	}

	

// *** SIDEBAR FUNCTION *** //
	
	//open chat window with new message inside (after message checking)
	function showConversation(){
		var th = $('#fbChat');
		th.attr('class','conversation').show().find('textarea').focus();
		/*th.find('textarea').on('keyup',function(e){

			// "enter" pressed
			if(e.keyCode==13){
				if(th.find('input').val()==''){
					alert('Entrez votre email SVP');
				}
				else if(th.find('textarea').val()==''){
					alert('Veuillez entrer un message SVP');
				}
				else if(confirm("Souhaitez-vous réellement m'envoyer cet email ?")){
					$('#conversationContent').addClass('show').find(".message").text(th.find('textarea').val());
					$('#conversationDate').text("Aujourd'hui");
					showConversation();
				}
			}
		});*/
	}

	// enable/disable chat
	function chatToggle(){
		var a = $('#sidebar');
		a.toggleClass('chatOff');
		if(a.hasClass('chatOff')){
			$('#chatToggle a').text('Activer la discussion instantanée');
		}
		else {
			$('#chatToggle a').text('Désactiver la discussion instantanée');
		}
	}

	// delete an item in suggestion list of friends and replace it by an other friend
	function deleteFriend(){
		iFriends++;
		var th = $(this).parent();

		if(iFriends<dataFriends.length){
			setTimeout(function(){
				th.find('img').attr('src',dataFriends[iFriends]['src']).parent().attr('href',dataFriends[iFriends]['url']).next().text(dataFriends[iFriends]['name']).attr('href',dataFriends[iFriends]['url']);
			},700);
		}
		else {
			th.slideUp();
		}
	}